## üîê Phase P1 - Routes d'Authentification

Avant de coder, analysons les endpoints d'authentification n√©cessaires pour ta plateforme m√©decins-patients.

## üìã Liste des Endpoints d'Authentification

### **1. Gestion des Codes OTP**

#### `POST /v1/auth/otp/send`
- **R√¥le** : G√©n√©rer et envoyer un code OTP par SMS
- **Utilisateurs** : Patients + M√©decins (inscription et connexion)
- **Corps** : `{ "telephone": "0102030405" }`
- **R√©ponse** : Confirmation d'envoi SMS
- **Logique** : 
  - Nettoyer le num√©ro de t√©l√©phone
  - G√©n√©rer code 4 chiffres
  - Soft delete anciens OTP
  - Envoyer via LeTexto
  - Sauvegarder en base avec expiration 5min

#### `POST /v1/auth/otp/verify`
- **R√¥le** : V√©rifier un code OTP et retourner les tokens
- **Utilisateurs** : Patients + M√©decins
- **Corps** : `{ "telephone": "0102030405", "otp": "1234" }`
- **R√©ponse** : Tokens JWT (access + refresh) + infos utilisateur
- **Logique** :
  - V√©rifier code non expir√©
  - V√©rifier correspondance t√©l√©phone/OTP
  - R√©cup√©rer utilisateur depuis DB
  - G√©n√©rer tokens selon r√¥le
  - Marquer OTP comme utilis√©

### **2. Inscription Utilisateurs**

#### `POST /v1/auth/register/patient`
- **R√¥le** : Inscription d'un nouveau patient
- **Corps** : 
  ```json
  {
    "nom": "Kouassi",
    "prenom": "Jean", 
    "telephone": "0102030405",
    "email": "jean@example.com",
    "password": "motdepasse123",
    "dateNaissance": "1990-01-15",
    "sexe": "M"
  }
  ```
- **Pr√©requis** : T√©l√©phone v√©rifi√© par OTP
- **R√©ponse** : Compte cr√©√© + tokens
- **Logique** :
  - V√©rifier OTP valid√© pour ce num√©ro
  - V√©rifier unicit√© email/t√©l√©phone
  - Hasher mot de passe
  - Cr√©er User + Patient
  - G√©n√©rer tokens

#### `POST /v1/auth/register/medecin`
- **R√¥le** : Inscription d'un nouveau m√©decin
- **Corps** :
  ```json
  {
    "nom": "Diabat√©",
    "prenom": "Dr Fatou",
    "telephone": "0102030405", 
    "email": "dr.fatou@example.com",
    "password": "motdepasse123",
    "numeroOrdre": "CI123456",
    "specialites": ["CARDIOLOGIE", "MEDECINE_GENERALE"]
  }
  ```
- **Statut initial** : EN_ATTENTE (validation admin requise)
- **R√©ponse** : Compte cr√©√© en attente + tokens
- **Logique** :
  - M√™me v√©rifications que patient
  - Cr√©er User + Medecin avec statutValidation: EN_ATTENTE
  - Notification admin pour validation

### **3. Connexion Standard**

#### `POST /v1/auth/login`
- **R√¥le** : Connexion classique email/password
- **Corps** : `{ "email": "user@example.com", "password": "motdepasse123" }`
- **R√©ponse** : Tokens + infos utilisateur selon r√¥le
- **Logique** :
  - V√©rifier email existe et utilisateur actif
  - V√©rifier mot de passe
  - G√©n√©rer tokens selon r√¥le
  - Diff√©rencier contexte par r√¥le (patient/m√©decin/admin)

### **4. Gestion des Sessions**

#### `POST /v1/auth/refresh`
- **R√¥le** : Renouveler un access token avec refresh token
- **Corps** : `{ "refreshToken": "eyJ..." }`
- **R√©ponse** : Nouveaux tokens
- **Restrictions** : Pas de refresh token pour les ADMIN
- **Logique** :
  - V√©rifier validit√© refresh token
  - V√©rifier utilisateur toujours actif
  - G√©n√©rer nouveaux tokens
  - R√©voquer ancien refresh token

#### `POST /v1/auth/logout`
- **R√¥le** : D√©connexion (invalider token actuel)
- **Headers** : `Authorization: Bearer <token>`
- **R√©ponse** : Confirmation d√©connexion
- **Logique** :
  - Marquer token comme r√©voqu√©
  - Logger action

#### `DELETE /v1/auth/logout/all`
- **R√¥le** : D√©connexion globale (tous les tokens)
- **Headers** : `Authorization: Bearer <token>`
- **R√©ponse** : Confirmation d√©connexion globale
- **Logique** :
  - R√©voquer tous les tokens utilisateur
  - Logger action

#### `GET /v1/auth/sessions`
- **R√¥le** : Lister les sessions actives
- **Headers** : `Authorization: Bearer <token>`
- **R√©ponse** : Liste des tokens actifs avec m√©tadonn√©es
- **Logique** :
  - R√©cup√©rer tokens non expir√©s/r√©voqu√©s
  - Identifier session actuelle

### **5. Gestion des Mots de Passe**

#### `POST /v1/auth/password/forgot`
- **R√¥le** : Demander r√©initialisation mot de passe
- **Corps** : `{ "email": "user@example.com" }`
- **R√©ponse** : Confirmation envoi (m√™me si email inexistant)
- **Logique** :
  - G√©n√©rer token de r√©initialisation
  - Envoyer email avec lien
  - Expiration 30min

#### `POST /v1/auth/password/reset`
- **R√¥le** : R√©initialiser mot de passe avec token
- **Corps** : `{ "token": "reset_token", "newPassword": "nouveau123" }`
- **R√©ponse** : Confirmation changement
- **Logique** :
  - V√©rifier token de reset valide
  - Hasher nouveau mot de passe
  - Invalider token de reset
  - R√©voquer tous les tokens existants

#### `PUT /v1/auth/password/change`
- **R√¥le** : Changer mot de passe (utilisateur connect√©)
- **Headers** : `Authorization: Bearer <token>`
- **Corps** : `{ "currentPassword": "ancien123", "newPassword": "nouveau123" }`
- **R√©ponse** : Confirmation changement
- **Logique** :
  - V√©rifier ancien mot de passe
  - Hasher nouveau mot de passe
  - Optionnel : r√©voquer autres sessions

### **6. Validation et Statuts**

#### `GET /v1/auth/me`
- **R√¥le** : R√©cup√©rer infos utilisateur connect√©
- **Headers** : `Authorization: Bearer <token>`
- **R√©ponse** : Profil utilisateur selon r√¥le
- **Logique** :
  - Retourner infos User + Patient/Medecin selon r√¥le
  - Inclure statut de validation pour m√©decins

#### `GET /v1/auth/status`
- **R√¥le** : V√©rifier statut du token/session
- **Headers** : `Authorization: Bearer <token>`
- **R√©ponse** : Validit√© token + infos session
- **Logique** :
  - V√©rifier token non expir√©/r√©voqu√©
  - Temps restant avant expiration

## üìä R√©capitulatif des Endpoints

| **Endpoint** | **M√©thode** | **Auth Requise** | **Utilisateurs** |
|--------------|-------------|------------------|------------------|
| `/auth/otp/send` | POST | ‚ùå | Tous |
| `/auth/otp/verify` | POST | ‚ùå | Tous |
| `/auth/register/patient` | POST | ‚ùå | Patients |
| `/auth/register/medecin` | POST | ‚ùå | M√©decins |
| `/auth/login` | POST | ‚ùå | Tous |
| `/auth/refresh` | POST | ‚ùå | Patients/M√©decins |
| `/auth/logout` | POST | ‚úÖ | Tous |
| `/auth/logout/all` | DELETE | ‚úÖ | Tous |
| `/auth/sessions` | GET | ‚úÖ | Tous |
| `/auth/password/forgot` | POST | ‚ùå | Tous |
| `/auth/password/reset` | POST | ‚ùå | Tous |
| `/auth/password/change` | PUT | ‚úÖ | Tous |
| `/auth/me` | GET | ‚úÖ | Tous |
| `/auth/status` | GET | ‚úÖ | Tous |

## üéØ Priorit√©s de D√©veloppement

### **P1A - MVP Core (Critique)**
1. `POST /auth/otp/send`
2. `POST /auth/otp/verify` 
3. `POST /auth/register/patient`
4. `POST /auth/login`
5. `GET /auth/me`

### **P1B - Fonctionnalit√©s Avanc√©es**
6. `POST /auth/register/medecin`
7. `POST /auth/refresh`
8. `POST /auth/logout`
9. `GET /auth/sessions`

### **P1C - S√©curit√© Renforc√©e**
10. `POST /auth/password/forgot`
11. `POST /auth/password/reset`
12. `PUT /auth/password/change`
13. `DELETE /auth/logout/all`
14. `GET /auth/status`

Cette architecture d'authentification couvre tous les besoins de ta plateforme m√©decins-patients avec une s√©curit√© robuste et une UX fluide.

Pr√™t √† commencer le d√©veloppement de P1A ? üöÄ